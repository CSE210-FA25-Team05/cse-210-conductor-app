generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model credentials {
  id            Int       @id @default(autoincrement())
  user_id       Int?
  password_hash String
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  deleted_at    DateTime? @db.Timestamp(6)
  users         users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model oauth_accounts {
  id               Int       @id @default(autoincrement())
  user_id          Int?
  auth_provider    String    @db.VarChar
  auth_provider_id String    @db.VarChar
  access_token     String?
  refresh_token    String?
  expires_at       DateTime? @db.Timestamp(6)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @default(now()) @db.Timestamp(6)
  deleted_at       DateTime? @db.Timestamp(6)
  users            users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([auth_provider, auth_provider_id])
  @@unique([user_id, auth_provider])
}

model users {
  id                Int              @id @default(autoincrement())
  uuid              String           @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  first_name        String?          @db.VarChar
  last_name         String?          @db.VarChar
  email             String           @unique @db.VarChar
  pronouns          String?          @db.VarChar
  global_role       String?          @default("student") @db.VarChar
  is_profile_complete Boolean        @default(false) @map("is_profile_complete")
  last_login        DateTime?        @db.Timestamp(6)
  created_at        DateTime?        @default(now()) @db.Timestamp(6)
  updated_at        DateTime?        @default(now()) @db.Timestamp(6)
  deleted_at        DateTime?        @db.Timestamp(6)
  credentials       credentials[]
  oauth_accounts    oauth_accounts[]
  enrollments       enrollments[]
  ta_teams          ta_teams[]       @relation("TaUser")
  attendances       attendances[]
  attendances_updated attendances[]  @relation("UpdatedBy")
  sessions          sessions[]
  journals          journals[]
  pulses            pulses[]
  interactions      interactions[] @relation("InteractionAuthor")
  interaction_participants interaction_participants[]
}

model courses {
  id          Int           @id @default(autoincrement())
  course_code String        @map("course_code") @db.VarChar
  course_name String        @map("course_name") @db.VarChar
  term        String        @db.VarChar
  section     String?       @db.VarChar
  start_date  DateTime?    @map("start_date") @db.Date
  end_date    DateTime?    @map("end_date") @db.Date
  created_at  DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at  DateTime?     @default(now()) @map("updated_at") @db.Timestamp(6)
  deleted_at DateTime?     @map("deleted_at") @db.Timestamp(6)
  join_code  String      @unique @map("join_code") @db.VarChar
  teams       teams[]
  enrollments enrollments[]
  ta_teams    ta_teams[]
  lectures    lectures[]
  attendances attendances[]
  journals    journals[]
  pulse_configs pulse_configs[]
  pulses      pulses[]
  interaction_configs interaction_configs[]
  interactions interactions[]

  @@unique([course_code, term, section])
}

model teams {
  id          Int       @id @default(autoincrement())
  course_id   Int       @map("course_id")
  name        String    @db.VarChar
  description String?   @db.Text
  created_at  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)
  deleted_at DateTime? @map("deleted_at") @db.Timestamp(6)
  courses     courses   @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  enrollments enrollments[]
  ta_teams    ta_teams[]

  @@unique([course_id, name])
}

model enrollments {
  id         Int       @id @default(autoincrement())
  user_id    Int       @map("user_id")
  course_id  Int       @map("course_id")
  team_id     Int?      @map("team_id")
  role       String    @default("student") @db.VarChar
  created_at DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)
  deleted_at DateTime? @map("deleted_at") @db.Timestamp(6)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  courses    courses   @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  teams      teams?    @relation(fields: [team_id], references: [id], onDelete: SetNull, onUpdate: NoAction)

  @@unique([user_id, course_id])
}

model ta_teams {
  id         Int       @id @default(autoincrement())
  ta_user_id Int      @map("ta_user_id")
  course_id  Int      @map("course_id")
  team_id    Int      @map("team_id")
  created_at DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)
  deleted_at DateTime? @map("deleted_at") @db.Timestamp(6)
  users      users     @relation("TaUser", fields: [ta_user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  courses    courses   @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  teams      teams     @relation(fields: [team_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([ta_user_id, course_id, team_id])
}

model lectures {
  id          Int       @id @default(autoincrement())
  course_id   Int       @map("course_id")
  lecture_date DateTime @map("lecture_date") @db.Date
  code        String?   @db.VarChar
  created_at  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)
  deleted_at DateTime? @map("deleted_at") @db.Timestamp(6)
  courses     courses   @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  attendances attendances[]

  @@map("lectures")
}

model attendances {
  id            Int       @id @default(autoincrement())
  course_id     Int       @map("course_id")
  lecture_id    Int       @map("lecture_id")
  user_id       Int       @map("user_id")
  updated_by    Int?      @map("updated_by")
  update_reason String?   @map("update_reason") @db.Text
  created_at    DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)
  deleted_at    DateTime? @map("deleted_at") @db.Timestamp(6)
  courses       courses   @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lectures      lectures  @relation(fields: [lecture_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users         users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_updated users?    @relation("UpdatedBy", fields: [updated_by], references: [id], onDelete: SetNull, onUpdate: NoAction)

  @@unique([lecture_id, user_id])
  @@map("attendances")
}

model sessions {
  id         Int       @id @default(autoincrement())
  session_id String    @unique
  user_id    Int
  created_at DateTime? @default(now()) @db.Timestamp(6)
  expires_at DateTime? @db.Timestamp(6)

  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model interaction_configs {
  id            Int       @id @default(autoincrement())
  course_id     Int       @map("course_id")
  config        Json      @map("config") @db.JsonB
  is_editable   Boolean   @default(true) @map("is_editable")
  created_at    DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)
  deleted_at    DateTime? @map("deleted_at") @db.Timestamp(6)

  courses       courses       @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  interactions  interactions[]

  @@map("interaction_configs")
}

model interactions {
  id                  Int       @id @default(autoincrement())
  course_id           Int       @map("course_id")
  author_id           Int       @map("author_id")
  interaction_config_id Int     @map("interaction_config_id")
  value               String    @map("value") @db.VarChar(255)
  description         String?   @map("description")
  created_at          DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  deleted_at          DateTime? @map("deleted_at") @db.Timestamp(6)

  courses             courses                    @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  authors             users                      @relation("InteractionAuthor", fields: [author_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  interaction_configs interaction_configs        @relation(fields: [interaction_config_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  participants        interaction_participants[]

  @@map("interactions")
}

model interaction_participants {
  id              Int       @id @default(autoincrement())
  interaction_id  Int       @map("interaction_id")
  user_id         Int       @map("user_id")
  created_at      DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  deleted_at      DateTime? @map("deleted_at") @db.Timestamp(6)

  interactions interactions @relation(fields: [interaction_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users        users        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([interaction_id, user_id])
  @@map("interaction_participants")
}

model journals {
  id            Int       @id @default(autoincrement())
  course_id     Int       @map("course_id")
  user_id       Int       @map("user_id")
  title         String?   @map("title") @db.VarChar(255)
  content       String?   @map("content") @db.Text
  is_private    Boolean   @default(true) @map("is_private")
  created_at    DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)
  deleted_at    DateTime? @map("deleted_at") @db.Timestamp(6)
  
  courses       courses   @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users         users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model pulse_configs {
  id            Int       @id @default(autoincrement())
  course_id     Int       @map("course_id")
  config        Json      @map("config") @db.JsonB
  is_editable   Boolean   @default(true) @map("is_editable")   
  created_at    DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)
  deleted_at    DateTime? @map("deleted_at") @db.Timestamp(6)
  pulses        pulses[]

  courses       courses   @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model pulses {
  id              Int           @id @default(autoincrement())
  course_id       Int           @map("course_id")
  user_id         Int           @map("user_id")
  pulse_config_id Int           @map("pulse_config_id")
  value           String        @map("value") @db.VarChar(255)
  description     String?       @map("description")
  created_at      DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)

  courses         courses       @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users           users         @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  pulse_configs   pulse_configs @relation(fields: [pulse_config_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}